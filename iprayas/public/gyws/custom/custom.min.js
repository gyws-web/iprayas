/**
 * Get operator list based on the member type in member page
 */
$(".member_type_a").click(function() {
    var member_type_id = $(this).attr('id');
    if(member_type_id != '') {
        var data = '{"data":{"member_type_id":'+member_type_id+'}}';
        $.ajax({
            url:"/operator-list-member-type-wise",
            data: data,
            dataType: 'json',
            type:'POST',
            contentType: 'application/json',
            success:function(data) {
                if(data.operator_details.length > 0) {
                    var resp = JSON.parse(JSON.stringify(data));
                    console.log(resp.operator_details[0].name);
                    var html ='';
                    for(var i=0; i<resp.operator_details.length; i++) {
                        html += '<div class="col-lg-4 col-md-4 col-sm-6">'+
                                    '<div class="team-member"><img src="/contents/operators/'+resp.operator_details[i].photo+'" class="mx-auto img-fluid rounded-circle">'+
                                        '<h4>'+resp.operator_details[i].name+'</h4>'+
                                        '<p class="text-muted">'+(resp.operator_details[i].department != '' ? resp.operator_details[i].department : resp.operator_details[i].designation_details.title)+'</p>'+
                                        '<ul class="list-inline social-buttons">'+
                                            '<li class="list-inline-item"><a href="mailto:'+resp.operator_details[i].email+'"><i class="fas fa-envelope"></i></a></li>'+
                                            '<li class="list-inline-item"><a href="'+resp.operator_details[i].facebook_link+'" target="_blank"><i class="fab fa-facebook-f"></i></a></li>'+
                                            '<li class="list-inline-item"><a href="'+resp.operator_details[i].linkedin_link+'" target="_blank"><i class="fab fa-linkedin-in"></i></a></li>'+
                                        '</ul>'+
                                    '</div>'+
                                '</div>';
                    }

                    $(".result-box").html(html);
                }
            },
            error:function(error) {
                console.log(error.responseText);
            }
        });
    }
});




/* $(".plus_count").click(function() {
    var data_id = $(this).attr('data-id');

    var count = $("#input_"+data_id).val();
    if(count == 0 || count == '') count = 1;
    else count++;
    $("#input_"+data_id).val(count);


    
    var cost = $("#cost_"+data_id).attr("data-cost");

    console.log(data_id + " ----  " + count + " ----- " + cost);
    
    var total = parseInt(count) * parseInt(cost);
    $("#total_"+data_id+ " span").html(total);
}); */

var donor_signup_required = "No";
var is_alert = false;
var temp_data_id = '';
$(".add_minus").click(function() {
    var action = $(this).attr("data-action");
    var data_amount_type = $(this).attr("data-amount-type");
    var data_amount = parseInt($(this).attr("data-amount"));
    var data_id = $(this).attr('data-id');
    var data_period = $('#period_'+data_id).val();
    var data_term = $('#term_'+data_id).val();
    $("#period").val(data_period);
    $("#term").val(data_term);
    var data_donation_type = $(this).attr("data-donation-type");
    if(temp_data_id ==''){
        temp_data_id  = data_id;
    }else{
        if(temp_data_id != data_id){
            $(".inc_dec").each(function(){
                var id = $(this).attr("id");
                var arrId = id.split("_");
                if(arrId[1] != data_id){
                    $(this).val('');
                }
            })
        }
    }    
    // if(is_alert){
    //     alert("You can choose maximum one subscription plan at a time.");
    //     is_alert = false;
    // }
    

    if(donor_signup_required == "No" || typeof donor_signup_required == "undefined") {
        donor_signup_required = $(this).attr('data-signup-required');
    }
    var is_donor_logged_in = $("#is_donor_logged_in").val();

    //var amount = 0;
    if(data_amount_type == "Flexible") {
        var amount = parseInt($("#input_"+data_id).val());
        //alert(amount);
        if(amount > 0) {
            if(action == "plus") {
                // is_alert = true;
                amount += data_amount;
            } else if(action == "minus") {
                
                if(amount >= data_amount) amount -= data_amount;
                if(amount <= 0) amount = 0;
            }
            
        } else {
            amount = data_amount;
        }

        $("#input_"+data_id).val(amount);
        $("#total_"+data_id+ " span").html(amount);
        updateProgramData(data_id, amount, action, data_period, data_term);

    } else if(data_amount_type == "Fixed") {
        var count = parseInt($("#input_"+data_id).val());
        if(action == "plus") {
            // is_alert = true;
            if(count > 0) count++;
            else count = 1;
        } else if(action == "minus") {
            if(count > 0) count--;
            else count = 0;
        }

        $("#input_"+data_id).val(count);
        var cost = $("#cost_"+data_id).attr("data-cost");
        var total = parseInt(count) * parseInt(cost);
        $("#total_"+data_id+ " span").html(total);

        updateProgramData(data_id, total, action, data_period, data_term);
    }


    


    var grand_total = 0;
    $(".price_lbl").each(function() {
        //console.log($(this).find("span").text());
        grand_total += parseInt($(this).find("span").text());
    });

    if(grand_total>0){

        $(".total_lbl").show();
        $(".total_lbl span").html(grand_total);
    }
    else{
        $(".total_lbl").hide();

    }
    
    $("#order-amt").val(grand_total);

    

    //if(grand_total > 0 && is_donor_logged_in == "true") {
    if(grand_total > 0) {
        $(".donation_buttons").show();
        $("#order-button1").show();
        $("#payButton").hide();
    } else {
        $(".donation_buttons").hide();
    }

});



jsonObj = [];
function updateProgramData(data_id, amount, plus_minus, data_period, data_term) {
    var is_exists = false;
    console.log("Length = " + jsonObj.length)
    if(jsonObj.length > 0) {
        for(var i=0; i<jsonObj.length; i++) {
            if(jsonObj[i].program_id == data_id) {
                /* if(amount == 0) {
                    //delete jsonObj[i];
                    jsonObj.splice(i, 1);
                    //jsonObj.remove(i);
                    console.log("DDDDDDDDDDD");
                } else { */
                    jsonObj[i].amount = amount;
                    jsonObj[i].count = (plus_minus == "plus" ? (jsonObj[i].count + 1) : (jsonObj[i].count - 1));
                    is_exists = true;
                //}
                break;
            }
        }
    }

    if(!is_exists) {
        //console.log("EEEEEEEEEEEEEEEEEEEEEEEEE")
        var item = {};
        item["program_id"] = data_id;
        item["count"] = 1;
        item["amount"] = amount;
        item["interval"] = data_term;
        item["period"] = data_period;
        jsonObj.push(item);
    }

    console.log(jsonObj);
}




/**
 * Set images dynamically in the event modal in home page and in the event tab in media page
 */
$(".portfolio-item, .portfolio_m-item").click(function() {
    var id = $(this).attr('data-id');
    if(id != '') {
        var title = $("#title_"+id).text();
        var images = $("#imgs_"+id).val();
        images = images.split(",");
        var count = images.length;
        var carousel_indicators = '';
        var carousel_inner = '';
        for(var i=0; i<count; i++) {
            if(i >= 1) {
                carousel_indicators += '<li data-target="#carouselExampleIndicators" data-slide-to="'+i+'"></li>';
                carousel_inner += '<div class="carousel-item">'+
                                    '<img src="/contents/events/'+id+'/'+images[i]+'" alt="First slide" style="width:100%;" class="d-block">'+
                                  '</div>';

            } else {
                carousel_indicators += '<li data-target="#carouselExampleIndicators" data-slide-to="'+i+'" class="active"></li>';
                carousel_inner += '<div class="carousel-item active">'+
                                    '<img src="/contents/events/'+id+'/'+images[i]+'" alt="First slide" style="width:100%;" class="d-block">'+
                                  '</div>';
            }
            
        }
        $(".to_title").html(title);
        $("ol.carousel-indicators").html(carousel_indicators);
        $("div.carousel-inner-events").html(carousel_inner);
    }
});



    /**
     * Open the file dialod browser 
     */
    $(".photo-upload-icon").click(function(e) {
        //alert("ss");
        $("#upload-pp").click();
    });


    /**
     * Image preview before upload
     */
    $("#upload-pp").change(function () {
        var regex_pattern = /^([a-zA-Z0-9\s_\\.\-:])+(.png|.gif|.jpeg|.jpg)$/;
        if (regex_pattern.test($(this).val().toLowerCase())) {
            if (this.files && this.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    $("#preview").attr("src", e.target.result);
                };
                reader.readAsDataURL(this.files[0]);
            }
        } else {
            alert("Please upload a valid image.");
        }
    });





